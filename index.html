<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Database Keuangan Evan</title>
</head>
<style>
body { 
    font-family: sans-serif; 
    padding: 20px; 
    max-width: 400px; 
    margin: auto; 
    background-color: #CBDDE9; 
    color: #2872A1;
}

.form-group { margin-bottom: 15px; }

label { 
    display: block; 
    margin-bottom: 5px; 
    font-weight: bold; 
    color: #2872A1;
}

input, select { 
    width: 100%; 
    padding: 10px; 
    box-sizing: border-box; 
    background-color: #f0f8ff; 
    border: 2px solid #2872A1;
    border-radius: 5px;
    color: #2872A1;
    font-size: 14px;
}

/* Style khusus untuk Switcher */
.switcher-box {
    background: #2872A1;
    padding: 10px;
    border-radius: 8px;
    margin-bottom: 20px;
    color: white;
    text-align: center;
}
.switcher-box select {
    margin-top: 5px;
    background: white;
    font-weight: bold;
}

button { 
    padding: 12px 15px; 
    background: #2872A1; 
    color: #CBDDE9; 
    border: none; 
    cursor: pointer; 
    width: 100%; 
    font-weight: bold;
    border-radius: 5px;
    font-size: 16px;
    margin-top: 10px;
}

button:disabled { 
    background: #cccccc; 
    cursor: not-allowed; 
}

#pesan { 
    margin-top: 15px; 
    font-weight: bold; 
    text-align: center; 
}

/* Helper untuk menyembunyikan form */
.hidden { display: none; }
</style>
<body>
    
    <div id="login-overlay" style="position:fixed; top:0; left:0; width:100%; height:100%; background:white; z-index:9999; display:flex; flex-direction:column; align-items:center; justify-content:center;">
        <h2 style="color:#2872A1;">ðŸ”’ Masukkan Sandi</h2>
        <input type="password" id="pin-input" style="padding:10px; margin-bottom:10px; width:200px; text-align:center;">
        <button onclick="cekLogin()" style="width:200px;">Buka Akses</button>
    </div>
    
    <h2 style="text-align: center;">Input Data Keuangan</h2>
    
    <div class="switcher-box">
        <label style="color:white;">Mau isi laporan apa?</label>
        <select id="pilih-laporan" onchange="gantiForm()">
            <option value="uang">ðŸ’° Laporan Keuangan Harian</option>
            <option value="perpuluhan">â›ª Laporan Perpuluhan</option>
        </select>
    </div>
    
    <div id="pesan"></div>

    <div id="container-uang">
        <form id="form-uang" autocomplete="off">
            <div class="form-group">
                <label>Tanggal</label>
                <input type="date" id="tgl_uang" required>
            </div>

            <div class="form-group">
                <label>Jenis Transaksi</label>
                <select id="jenis_uang" required>
                    <option value="" disabled selected>Pilih...</option>
                    <option value="pemasukan">Pemasukan</option>
                    <option value="pengeluaran">Pengeluaran</option>
                </select>
            </div>

            <div class="form-group">
                <label>Metode Pembayaran</label>
                <select id="metode_uang" required>
                    <option value="" disabled selected>Pilih...</option>
                    <option value="tunai">Tunai</option>
                    <option value="transfer bca">Bank BCA</option>
                    <option value="transfer bni">Bank BNI</option>
                </select>
            </div>

            <div class="form-group">
                <label>Jumlah (Rp)</label>
                <input type="number" id="jumlah_uang" placeholder="0" required>
            </div>

            <div class="form-group">
                <label>Keterangan</label>
                <input type="text" id="ket_uang" required>
            </div>

            <button type="submit" id="btn-uang">Simpan Keuangan</button>
        </form>
    </div>

    <div id="container-perpuluhan" class="hidden">
        <form id="form-perpuluhan" autocomplete="off">
            <div class="form-group">
                <label>Tanggal</label>
                <input type="date" id="tgl_puluhan" required>
            </div>

            <div class="form-group">
                <label>Keterangan Barang/Jasa</label>
                <input type="text" id="ket_puluhan" placeholder="Misal: Karet Bracket" required>
            </div>

            <div class="form-group">
                <label>Modal (Rp)</label>
                <input type="number" id="modal_puluhan" placeholder="0" required>
            </div>

            <div class="form-group">
                <label>Dapat / Omset (Rp)</label>
                <input type="number" id="dapat_puluhan" placeholder="0" required>
            </div>
            
            <div class="form-group">
                <label>Status</label>
                <select id="status_puluhan" required>
                    <option value="Belum">Belum Disetor</option>
                    <option value="Sudah">Sudah Disetor</option>
                </select>
            </div>

            <button type="submit" id="btn-puluhan">Simpan Perpuluhan</button>
        </form>
    </div>

    <script>
        // --- 1. CONFIGURATION ---
        // Ganti dengan URL Google Script kamu yang baru (yang sudah support 2 tab)
        const scriptURL = 'https://script.google.com/macros/s/AKfycbx8Dy9sM4lLP-WywIfPX9gMxoF2m9vFD6vwlicR5XDm6WmXH4-QpxjXlSkfayOfXj10QQ/exec'; 
        const divPesan = document.getElementById('pesan');

        // --- 2. LOGIN SYSTEM ---
        function cekLogin() {
            const pin = document.getElementById('pin-input').value;
            const pinBenar = "uangevan"; 
            if (pin === pinBenar) {
                document.getElementById('login-overlay').style.display = 'none';
                sessionStorage.setItem('isLoggedIn', 'true');
            } else {
                alert("Sandi Salah!");
            }
        }
        
        if (sessionStorage.getItem('isLoggedIn') === 'true') {
            document.getElementById('login-overlay').style.display = 'none';
        }

        document.getElementById('pin-input').addEventListener('keypress', function (e) {
            if (e.key === 'Enter') cekLogin();
        });

        // --- 3. AUTO DATE SYSTEM ---
        function setTodayDate() {
            const today = new Date();
            const tahun = today.getFullYear();
            const bulan = String(today.getMonth() + 1).padStart(2, '0'); 
            const hari = String(today.getDate()).padStart(2, '0');
            const formatTgl = `${tahun}-${bulan}-${hari}`;
            
            document.getElementById('tgl_uang').value = formatTgl;
            document.getElementById('tgl_puluhan').value = formatTgl;
        }
        setTodayDate();

        // --- 4. SWITCHER FORM SYSTEM ---
        function gantiForm() {
            const pilihan = document.getElementById('pilih-laporan').value;
            const formUang = document.getElementById('container-uang');
            const formPuluhan = document.getElementById('container-perpuluhan');
            
            divPesan.textContent = ''; // Reset pesan

            if (pilihan === 'uang') {
                formUang.classList.remove('hidden');
                formPuluhan.classList.add('hidden');
            } else {
                formUang.classList.add('hidden');
                formPuluhan.classList.remove('hidden');
            }
        }

        // --- 5. SUBMIT HANDLER: LAPORAN KEUANGAN ---
        const formUang = document.getElementById('form-uang');
        formUang.addEventListener('submit', e => {
            e.preventDefault();
            const btn = document.getElementById('btn-uang');
            kirimData(btn, {
                target: 'laporanuang', // KUNCI: Beri tahu script ini untuk sheet 'laporanuang'
                tanggal: document.getElementById('tgl_uang').value,
                jenis: document.getElementById('jenis_uang').value,
                metode: document.getElementById('metode_uang').value,
                jumlah: document.getElementById('jumlah_uang').value,
                keterangan: document.getElementById('ket_uang').value
            }, formUang);
        });

        // --- 6. SUBMIT HANDLER: PERPULUHAN ---
        const formPuluhan = document.getElementById('form-perpuluhan');
        formPuluhan.addEventListener('submit', e => {
            e.preventDefault();
            
            // HITUNG OTOMATIS
            const modal = parseInt(document.getElementById('modal_puluhan').value) || 0;
            const dapat = parseInt(document.getElementById('dapat_puluhan').value) || 0;
            const pendapatan = dapat - modal; // Profit
            const perpuluhan = pendapatan * 0.1; // 10%

            const btn = document.getElementById('btn-puluhan');
            
            kirimData(btn, {
                target: 'perpuluhan', // KUNCI: Beri tahu script ini untuk sheet 'perpuluhan'
                tanggal: document.getElementById('tgl_puluhan').value,
                keterangan: document.getElementById('ket_puluhan').value,
                modal: modal,
                dapat: dapat,
                pendapatan: pendapatan, // Hasil hitungan otomatis dikirim
                perpuluhan: perpuluhan, // Hasil hitungan otomatis dikirim
                status: document.getElementById('status_puluhan').value
            }, formPuluhan);
        });

        // --- 7. FUNGSI KIRIM DATA (Global) ---
        function kirimData(tombol, dataObjek, formElemen) {
            tombol.disabled = true;
            tombol.textContent = 'Menyimpan...';
            divPesan.textContent = '';

            fetch(scriptURL, {
                method: 'POST',
                body: JSON.stringify(dataObjek)
            })
            .then(response => response.json())
            .then(data => {
                if(data.status === 'success') {
                    divPesan.textContent = 'âœ… Berhasil: ' + data.message;
                    divPesan.style.color = 'green';
                    formElemen.reset();
                    setTodayDate(); // Reset tanggal ke hari ini lagi
                } else {
                    throw new Error(data.message);
                }
            })
            .catch(error => {
                divPesan.textContent = 'âŒ Gagal: ' + error.message;
                divPesan.style.color = 'red';
            })
            .finally(() => {
                tombol.disabled = false;
                tombol.textContent = 'Simpan Data';
            });
        }
    </script>
</body>
</html>
